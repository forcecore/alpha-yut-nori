var J=Object.defineProperty;var Z=(S,e,t)=>e in S?J(S,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):S[e]=t;var c=(S,e,t)=>Z(S,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();const f=class f{getNextPosition(e,t){var i;if(t===0)return e;if(t===-1){const s=f.BACK_DO[e];return(s==null?void 0:s[0])??null}return((i=f.MOVE_TABLE[e])==null?void 0:i[t])??null}getBackDoDestinations(e){return f.BACK_DO[e]??[]}triggersShortcut(e){return e==="05"||e==="10"}static getEntryPosition(e){return e>=1&&e<=5?String(e).padStart(2,"0"):"01"}static isFinishPosition(e,t){return e==="00"&&t}isValidPosition(e){return f.ALL_POSITIONS.has(e)}};c(f,"NUM_POSITIONS",29),c(f,"START_POSITION","00"),c(f,"GOAL_POSITION","00"),c(f,"OUTER_POSITIONS",Array.from({length:20},(e,t)=>String(t).padStart(2,"0"))),c(f,"RIGHT_DIAGONAL",["aa","bb","cc","pp","qq"]),c(f,"LEFT_DIAGONAL",["xx","yy","cc","uu","vv"]),c(f,"ALL_POSITIONS",new Set([...f.OUTER_POSITIONS,...f.RIGHT_DIAGONAL,...f.LEFT_DIAGONAL])),c(f,"DIAGONAL_CELLS",new Set(["aa","bb","cc","pp","qq","xx","yy","uu","vv"])),c(f,"MOVE_TABLE",{"00":{1:"01",2:"02",3:"03",4:"04",5:"05"},"01":{1:"02",2:"03",3:"04",4:"05",5:"06"},"02":{1:"03",2:"04",3:"05",4:"06",5:"07"},"03":{1:"04",2:"05",3:"06",4:"07",5:"08"},"04":{1:"05",2:"06",3:"07",4:"08",5:"09"},"05":{1:"aa",2:"bb",3:"cc",4:"uu",5:"vv"},"06":{1:"07",2:"08",3:"09",4:"10",5:"11"},"07":{1:"08",2:"09",3:"10",4:"11",5:"12"},"08":{1:"09",2:"10",3:"11",4:"12",5:"13"},"09":{1:"10",2:"11",3:"12",4:"13",5:"14"},10:{1:"xx",2:"yy",3:"cc",4:"pp",5:"qq"},11:{1:"12",2:"13",3:"14",4:"15",5:"16"},12:{1:"13",2:"14",3:"15",4:"16",5:"17"},13:{1:"14",2:"15",3:"16",4:"17",5:"18"},14:{1:"15",2:"16",3:"17",4:"18",5:"19"},15:{1:"16",2:"17",3:"18",4:"19",5:"00"},16:{1:"17",2:"18",3:"19",4:"00"},17:{1:"18",2:"19",3:"00"},18:{1:"19",2:"00"},19:{1:"00"},aa:{1:"bb",2:"cc",3:"uu",4:"vv",5:"15"},bb:{1:"cc",2:"uu",3:"vv",4:"15",5:"16"},cc:{1:"pp",2:"qq",3:"00"},pp:{1:"qq",2:"00"},qq:{1:"00"},xx:{1:"yy",2:"cc",3:"pp",4:"qq",5:"00"},yy:{1:"cc",2:"pp",3:"qq",4:"00"},uu:{1:"vv",2:"15",3:"16",4:"17",5:"18"},vv:{1:"15",2:"16",3:"17",4:"18",5:"19"}}),c(f,"BACK_DO",{"01":["00"],"02":["01"],"03":["02"],"04":["03"],"05":["04"],"06":["05"],"07":["06"],"08":["07"],"09":["08"],10:["09"],11:["10"],12:["11"],13:["12"],14:["13"],15:["14","vv"],16:["15"],17:["16"],18:["17"],19:["18"],"00":["19","qq"],aa:["05"],bb:["aa"],cc:["bb","yy"],uu:["cc"],vv:["uu"],xx:["10"],yy:["xx"],pp:["cc"],qq:["pp"]});let V=f;class j{constructor(e,t){c(this,"pieceId");c(this,"playerId");c(this,"position",null);c(this,"isActive",!1);c(this,"hasMoved",!1);this.pieceId=e,this.playerId=t}enterBoard(e){this.position=e,this.isActive=!0,this.hasMoved=!0}moveTo(e){this.position=e,this.hasMoved=!0}finish(){this.position=null,this.isActive=!1}capture(){this.position=null,this.isActive=!1,this.hasMoved=!1}hasFinished(){return!this.isActive&&this.hasMoved&&this.position===null}clone(){const e=new j(this.pieceId,this.playerId);return e.position=this.position,e.isActive=this.isActive,e.hasMoved=this.hasMoved,e}}const O=class O{constructor(e,t){c(this,"playerId");c(this,"name");c(this,"pieces");this.playerId=e,this.name=t,this.pieces=Array.from({length:O.NUM_PIECES},(i,s)=>new j(s,e))}getActivePieces(){return this.pieces.filter(e=>e.isActive)}getFinishedPieces(){return this.pieces.filter(e=>e.hasFinished())}getInactivePieces(){return this.pieces.filter(e=>!e.isActive&&!e.hasFinished())}hasFinished(){return this.getFinishedPieces().length===O.NUM_PIECES}getStacks(){const e=new Map;for(const t of this.getActivePieces())if(t.position!==null){const i=e.get(t.position);i?i.push(t):e.set(t.position,[t])}return e}getPieceById(e){return this.pieces[e]}canEnterNewPiece(){return this.getInactivePieces().length>0}clone(){const e=new O(this.playerId,this.name);return e.pieces=this.pieces.map(t=>t.clone()),e}};c(O,"NUM_PIECES",4);let K=O;const A=class A{static throw(){const e=Array.from({length:4},()=>Math.random()<A.FLAT_PROBABILITY),t=e.filter(Boolean).length;let i=A.THROW_NAMES[t];return i==="do"&&e.indexOf(!0)===0&&(i="back_do"),{name:i,value:A.MOVE_VALUES[i],sticks:e}}static grantsExtraTurn(e){return A.EXTRA_TURN_THROWS.has(e)}static getMoveValue(e){return A.MOVE_VALUES[e]}};c(A,"THROW_NAMES",{1:"do",2:"gae",3:"geol",4:"yut",0:"mo"}),c(A,"MOVE_VALUES",{do:1,back_do:-1,gae:2,geol:3,yut:4,mo:5}),c(A,"EXTRA_TURN_THROWS",new Set(["yut","mo"])),c(A,"FLAT_PROBABILITY",.6),c(A,"KOREAN_NAMES",{do:"ë„",back_do:"ë¹½ë„",gae:"ê°œ",geol:"ê±¸",yut:"ìœ·",mo:"ëª¨"});let D=A;class z{constructor(e,t=4){c(this,"board");c(this,"numPlayers");c(this,"players");c(this,"currentPlayerIdx");c(this,"gameState");c(this,"winner");c(this,"rankings");c(this,"accumulatedMoves");c(this,"moveHistory");if(t<2||t>6)throw new Error("Number of players must be between 2 and 6");const i=e??Array.from({length:t},(s,n)=>`Player ${n}`);if(i.length!==t)throw new Error(`Must provide exactly ${t} player names`);this.board=new V,this.numPlayers=t,this.players=i.map((s,n)=>new K(n,s)),this.currentPlayerIdx=0,this.gameState="playing",this.winner=null,this.rankings=[],this.accumulatedMoves=[],this.moveHistory=[]}getCurrentPlayer(){return this.players[this.currentPlayerIdx]}throwPhase(e=!1){const t=[];for(e||(this.accumulatedMoves=[]);;){const i=D.throw();t.push(i),this.accumulatedMoves.push(i.value);const s=e?" (bonus)":"";if(this.logMove(`${this.getCurrentPlayer().name} threw ${i.name} (${i.value} spaces)${s}`),!D.grantsExtraTurn(i.name))break}return t}getLegalMoves(e){const t=this.players[e],i=[];for(const s of t.getActivePieces()){if(s.position==="00"&&s.hasMoved){for(const n of this.accumulatedMoves)if(n===-1)for(const r of this.board.getBackDoDestinations("00"))i.push({pieceId:s.pieceId,steps:n,destination:r});else i.push({pieceId:s.pieceId,steps:n,destination:"EXIT"});continue}for(const n of this.accumulatedMoves)if(n===-1)for(const r of this.board.getBackDoDestinations(s.position))i.push({pieceId:s.pieceId,steps:n,destination:r});else{const r=this.board.getNextPosition(s.position,n);r!==null&&i.push({pieceId:s.pieceId,steps:n,destination:r})}}if(t.canEnterNewPiece()&&this.accumulatedMoves.length>0){for(const s of this.accumulatedMoves)if(s>=1&&s<=5){const n=String(s).padStart(2,"0");i.push({pieceId:-1,steps:s,destination:n})}}return i}movePiece(e,t,i,s){const n=this.players[e];if(t===-1){if(!n.canEnterNewPiece())return{success:!1,captured:!1};if(!this.accumulatedMoves.includes(i))return{success:!1,captured:!1};if(i<1||i>5)return{success:!1,captured:!1};const d=String(i).padStart(2,"0"),p=n.getInactivePieces()[0];return p.enterBoard(d),this.removeAccumulatedMove(i),this.board.triggersShortcut(d)?this.logMove(`${n.name} entered new piece (Piece ${p.pieceId}) at position ${d} (shortcut position)`):this.logMove(`${n.name} entered new piece (Piece ${p.pieceId}) at position ${d}`),{success:!0,captured:this.checkCapture(e,p.position)}}const r=n.getPieceById(t);if(!r.isActive)return{success:!1,captured:!1};if(!this.accumulatedMoves.includes(i))return{success:!1,captured:!1};const a=r.position;if(a==="00"&&r.hasMoved&&i!==-1){const d=this.getStackAtPosition(e,a),p=d.length===1?`Piece ${t}`:`Stack (x${d.length})`;for(const g of d)g.finish();return this.removeAccumulatedMove(i),this.logMove(`${n.name}'s ${p} exited the board!`),{success:!0,captured:!1}}let o;if(i===-1&&s){if(!this.board.getBackDoDestinations(a).includes(s))return{success:!1,captured:!1};o=s}else o=this.board.getNextPosition(a,i);if(o===null)return{success:!1,captured:!1};const h=this.getStackAtPosition(e,a);for(const d of h)d.moveTo(o);this.removeAccumulatedMove(i);const l=h.length===1?`Piece ${t}`:`Stack (x${h.length})`;return o==="00"?this.logMove(`${n.name} moved ${l} ${i} spaces to position 00 (at goal - next move exits)`):this.board.triggersShortcut(o)?this.logMove(`${n.name} moved ${l} ${i} spaces to ${o} (shortcut position - next move uses diagonal)`):this.logMove(`${n.name} moved ${l} ${i} spaces to ${o}`),{success:!0,captured:this.checkCapture(e,o)}}getStackAtPosition(e,t){return this.players[e].getActivePieces().filter(s=>s.position===t)}checkCapture(e,t){let i=!1;for(const s of this.players){if(s.playerId===e)continue;const n=s.getActivePieces().filter(r=>r.position===t);if(n.length>0){i=!0;for(const r of n)r.capture(),this.logMove(`${this.players[e].name} captured ${s.name}'s Piece ${r.pieceId}!`)}}return i}checkWinCondition(){let e=!1;for(const i of this.players)if(i.hasFinished()&&!this.rankings.includes(i.playerId)){this.rankings.push(i.playerId);const s=this.rankings.length;this.logMove(`${i.name} finishes in place #${s}!`),this.winner===null&&(this.winner=i.playerId),e=!0}const t=this.players.filter(i=>!this.rankings.includes(i.playerId));return t.length<=1?(t.length===1&&this.rankings.push(t[0].playerId),this.gameState="finished",!0):e}nextTurn(){for(let e=0;e<this.numPlayers&&(this.currentPlayerIdx=(this.currentPlayerIdx+1)%this.numPlayers,!!this.rankings.includes(this.currentPlayerIdx));e++);this.accumulatedMoves=[]}logMove(e){this.moveHistory.push(e)}getGameState(){return{currentPlayer:this.currentPlayerIdx,gameState:this.gameState,winner:this.winner,rankings:[...this.rankings],accumulatedMoves:[...this.accumulatedMoves],players:this.players.map(e=>({id:e.playerId,name:e.name,activePieces:e.getActivePieces().length,finishedPieces:e.getFinishedPieces().length,pieces:e.pieces.map(t=>({id:t.pieceId,position:t.position,isActive:t.isActive,hasMoved:t.hasMoved}))})),moveHistory:this.moveHistory.slice(-10)}}getAllPieces(){return this.players.flatMap(e=>e.pieces)}clone(){const e=Object.create(z.prototype);return e.board=this.board,e.numPlayers=this.numPlayers,e.players=this.players.map(t=>t.clone()),e.currentPlayerIdx=this.currentPlayerIdx,e.gameState=this.gameState,e.winner=this.winner,e.rankings=[...this.rankings],e.accumulatedMoves=[...this.accumulatedMoves],e.moveHistory=[],e}removeAccumulatedMove(e){const t=this.accumulatedMoves.indexOf(e);t!==-1&&this.accumulatedMoves.splice(t,1)}}const k=600,C=60,P={x:C,y:C},x={x:k-C,y:C},M={x:k-C,y:k-C},L={x:C,y:k-C},E={x:k/2,y:k/2};function y(S,e,t){return{x:S.x+(e.x-S.x)*t,y:S.y+(e.y-S.y)*t}}const $={"00":M,"01":y(M,x,1/5),"02":y(M,x,2/5),"03":y(M,x,3/5),"04":y(M,x,4/5),"05":x,"06":y(x,P,1/5),"07":y(x,P,2/5),"08":y(x,P,3/5),"09":y(x,P,4/5),10:P,11:y(P,L,1/5),12:y(P,L,2/5),13:y(P,L,3/5),14:y(P,L,4/5),15:L,16:y(L,M,1/5),17:y(L,M,2/5),18:y(L,M,3/5),19:y(L,M,4/5),aa:y(x,E,1/3),bb:y(x,E,2/3),cc:E,uu:y(E,L,1/3),vv:y(E,L,2/3),xx:y(P,E,1/3),yy:y(P,E,2/3),pp:y(E,M,1/3),qq:y(E,M,2/3)},ee=[["00","01"],["01","02"],["02","03"],["03","04"],["04","05"],["05","06"],["06","07"],["07","08"],["08","09"],["09","10"],["10","11"],["11","12"],["12","13"],["13","14"],["14","15"],["15","16"],["16","17"],["17","18"],["18","19"],["19","00"],["05","aa"],["aa","bb"],["bb","cc"],["cc","uu"],["uu","vv"],["vv","15"],["10","xx"],["xx","yy"],["yy","cc"],["cc","pp"],["pp","qq"],["qq","00"]],te=new Set(["00","05","10","15","cc"]),se=16,T=22,U=13,B=["#e74c3c","#3498db","#2ecc71","#f1c40f"],H=["Q","W","E","R"],ie=["Satoshi Nakamoto BTC","Vitalik Buterin ETH","Billy Markus DOGE","Sam Altman WLD"],ne=[{x:k-20,y:k-20,stackDir:-1},{x:k-20,y:20,stackDir:1},{x:20,y:20,stackDir:1},{x:20,y:k-20,stackDir:-1}],m="http://www.w3.org/2000/svg";class re{constructor(e){c(this,"svg");c(this,"staticLayer");c(this,"pieceLayer");c(this,"highlightLayer");c(this,"onPieceClickCb",null);c(this,"onPositionClickCb",null);c(this,"onNewPieceClickCb",null);this.svg=e,this.staticLayer=this.createGroup("static-layer"),this.highlightLayer=this.createGroup("highlight-layer"),this.pieceLayer=this.createGroup("piece-layer"),this.svg.appendChild(this.staticLayer),this.svg.appendChild(this.highlightLayer),this.svg.appendChild(this.pieceLayer),this.drawStaticBoard()}createGroup(e){const t=document.createElementNS(m,"g");return t.id=e,t}drawStaticBoard(){for(const[i,s]of ee){const n=$[i],r=$[s],a=document.createElementNS(m,"line");a.setAttribute("x1",String(n.x)),a.setAttribute("y1",String(n.y)),a.setAttribute("x2",String(r.x)),a.setAttribute("y2",String(r.y)),a.classList.add("board-line"),this.staticLayer.appendChild(a)}for(const[i,s]of Object.entries($)){const n=te.has(i),r=n?T:se,a=document.createElementNS(m,"circle");a.setAttribute("cx",String(s.x)),a.setAttribute("cy",String(s.y)),a.setAttribute("r",String(r)),a.classList.add("board-node"),n&&a.classList.add("corner"),a.dataset.position=i,a.addEventListener("click",()=>{var h;(h=this.onPositionClickCb)==null||h.call(this,i)}),this.staticLayer.appendChild(a);const o=document.createElementNS(m,"text");o.setAttribute("x",String(s.x)),o.setAttribute("y",String(s.y+r+12)),o.classList.add("board-label"),o.textContent=i,this.staticLayer.appendChild(o)}const e=$["00"],t=document.createElementNS(m,"text");t.setAttribute("x",String(e.x)),t.setAttribute("y",String(e.y)),t.classList.add("board-label"),t.style.fontSize="9px",t.style.fill="#aaa",t.textContent="START",this.staticLayer.appendChild(t)}updatePieces(e,t,i){for(;this.pieceLayer.firstChild;)this.pieceLayer.removeChild(this.pieceLayer.firstChild);t&&this.drawReserves(t,i);const s=new Map;for(const n of e){if(!n.isActive||n.position===null)continue;const r=n.position;s.has(r)||s.set(r,[]);const a=s.get(r);let o=a.find(h=>h.playerId===n.playerId);o||(o={playerId:n.playerId,pieces:[],position:n.position},a.push(o)),o.pieces.push(n)}for(const[n,r]of s){const a=$[n];if(!a)continue;const o=r.length;r.forEach((h,l)=>{const u=o>1?(l-(o-1)/2)*28:0,d=h.pieces.length,p=-8;for(let g=0;g<d;g++){const v=h.pieces[g],G=a.x+u,N=a.y+g*p,b=document.createElementNS(m,"g");b.classList.add("piece-group"),b.style.transform=`translate(${G}px, ${N}px)`,b.dataset.playerId=String(h.playerId),b.dataset.pieceId=String(v.pieceId),b.dataset.position=n,b.addEventListener("click",I=>{var Y;I.stopPropagation(),(Y=this.onPieceClickCb)==null||Y.call(this,h.playerId,h.pieces[0].pieceId)});const w=document.createElementNS(m,"circle");if(w.setAttribute("cx","0"),w.setAttribute("cy","0"),w.setAttribute("r",String(U)),w.classList.add("piece-circle"),w.style.fill=B[h.playerId]??"#888",b.appendChild(w),g===d-1&&h.playerId===i){const I=document.createElementNS(m,"text");I.setAttribute("x","0"),I.setAttribute("y","0"),I.classList.add("piece-label"),I.textContent=H[v.pieceId]??String(v.pieceId),b.appendChild(I)}this.pieceLayer.appendChild(b)}})}}drawReserves(e,t){for(const n of e){const r=n.getInactivePieces();if(r.length===0)continue;const a=ne[n.playerId];if(a)for(let o=0;o<r.length;o++){const h=r[o],l=a.x,u=a.y+o*8*a.stackDir,d=document.createElementNS(m,"g");d.classList.add("piece-group","reserve-piece"),d.style.transform=`translate(${l}px, ${u}px)`,d.dataset.playerId=String(n.playerId),d.dataset.pieceId=String(h.pieceId),d.dataset.reserve="true",d.addEventListener("click",g=>{var v;g.stopPropagation(),(v=this.onNewPieceClickCb)==null||v.call(this)});const p=document.createElementNS(m,"circle");if(p.setAttribute("cx","0"),p.setAttribute("cy","0"),p.setAttribute("r",String(11)),p.classList.add("piece-circle"),p.style.fill=B[n.playerId]??"#888",p.style.opacity="0.6",d.appendChild(p),o===r.length-1&&n.playerId===t){const g=document.createElementNS(m,"text");g.setAttribute("x","0"),g.setAttribute("y","0"),g.classList.add("piece-label"),g.style.opacity="0.8",g.textContent="N",d.appendChild(g)}this.pieceLayer.appendChild(d)}}}highlightPieces(e,t,i){this.clearHighlights();const s=this.pieceLayer.querySelectorAll(".piece-group");for(const n of s){const r=n,a=Number(r.dataset.playerId),o=Number(r.dataset.pieceId);if(a===e&&t.has(o)){const h=document.createElementNS(m,"circle");h.setAttribute("cx","0"),h.setAttribute("cy","0"),h.setAttribute("r",String(U+5)),h.classList.add("highlight-ring"),r.insertBefore(h,r.firstChild)}}}selectPiece(e,t){const i=this.pieceLayer.querySelectorAll(".piece-group");for(const s of i){const n=s;if(Number(n.dataset.playerId)===e&&Number(n.dataset.pieceId)===t){const r=U+6,a=6,o=document.createElementNS(m,"path");o.setAttribute("d",[`M${-r},${-r+a} L${-r},${-r} L${-r+a},${-r}`,`M${r-a},${-r} L${r},${-r} L${r},${-r+a}`,`M${r},${r-a} L${r},${r} L${r-a},${r}`,`M${-r+a},${r} L${-r},${r} L${-r},${r-a}`].join(" ")),o.classList.add("selection-bracket"),n.appendChild(o);break}}}highlightDestinations(e){this.svg.appendChild(this.highlightLayer);for(const[t,i]of e){if(t==="EXIT"){this.drawExitArrow(i);continue}const s=$[t];if(!s)continue;const n=document.createElementNS(m,"g");n.style.cursor="pointer",n.addEventListener("click",()=>{var a;(a=this.onPositionClickCb)==null||a.call(this,t)});const r=document.createElementNS(m,"circle");if(r.setAttribute("cx",String(s.x)),r.setAttribute("cy",String(s.y)),r.setAttribute("r",String(T)),r.classList.add("dest-highlight"),r.dataset.destPosition=t,n.appendChild(r),i){const a=document.createElementNS(m,"text");a.setAttribute("x",String(s.x+T+8)),a.setAttribute("y",String(s.y)),a.classList.add("dest-key-label"),a.textContent=i,n.appendChild(a)}this.highlightLayer.appendChild(n)}}drawExitArrow(e){const t=$["00"],i=t.x,s=t.y,n=document.createElementNS(m,"g");n.classList.add("exit-indicator"),n.style.cursor="pointer",n.addEventListener("click",()=>{var u;(u=this.onPositionClickCb)==null||u.call(this,"EXIT")});const r=document.createElementNS(m,"g");r.classList.add("exit-rays-group"),r.style.transformOrigin=`${i}px ${s}px`;const a=8,o=T+6,h=T+22;for(let u=0;u<a;u++){const d=u/a*Math.PI*2,p=document.createElementNS(m,"line");p.setAttribute("x1",String(i+Math.cos(d)*o)),p.setAttribute("y1",String(s+Math.sin(d)*o)),p.setAttribute("x2",String(i+Math.cos(d)*h)),p.setAttribute("y2",String(s+Math.sin(d)*h)),p.classList.add("exit-ray"),r.appendChild(p)}n.appendChild(r);const l=document.createElementNS(m,"text");l.setAttribute("x",String(i)),l.setAttribute("y",String(s-T-26)),l.classList.add("dest-key-label"),l.style.textAnchor="middle",l.textContent=e?`[${e}] EXIT`:"EXIT",n.appendChild(l),this.highlightLayer.appendChild(n)}clearHighlights(){for(;this.highlightLayer.firstChild;)this.highlightLayer.removeChild(this.highlightLayer.firstChild);this.svg.insertBefore(this.highlightLayer,this.pieceLayer);for(const e of this.pieceLayer.querySelectorAll(".highlight-ring, .selection-bracket"))e.remove()}showCaptureEffect(){const i=document.createElementNS(m,"g");i.classList.add("capture-effect");const s=12;for(let o=0;o<s;o++){const h=o/s*Math.PI*2,l=document.createElementNS(m,"line");l.setAttribute("x1",String(300)),l.setAttribute("y1",String(300)),l.setAttribute("x2",String(300+Math.cos(h)*120)),l.setAttribute("y2",String(300+Math.sin(h)*120)),l.classList.add("capture-ray"),i.appendChild(l)}const n=document.createElementNS(m,"circle");n.setAttribute("cx",String(300)),n.setAttribute("cy",String(300)),n.setAttribute("r","60"),n.classList.add("capture-glow"),i.appendChild(n);const r=document.createElementNS(m,"text");r.setAttribute("x",String(300)),r.setAttribute("y",String(292)),r.classList.add("capture-text"),r.textContent="CAPTURE!",i.appendChild(r);const a=document.createElementNS(m,"text");return a.setAttribute("x",String(300)),a.setAttribute("y",String(320)),a.classList.add("capture-subtext"),a.textContent="BONUS THROW",i.appendChild(a),this.svg.appendChild(i),new Promise(o=>{setTimeout(()=>{i.remove(),o()},1200)})}showGameOverEffect(e){const s=document.createElementNS(m,"g");s.classList.add("gameover-effect");const n=document.createElementNS(m,"rect");n.setAttribute("x","0"),n.setAttribute("y","0"),n.setAttribute("width","600"),n.setAttribute("height","600"),n.classList.add("gameover-backdrop"),s.appendChild(n);const r=16;for(let h=0;h<r;h++){const l=h/r*Math.PI*2,u=document.createElementNS(m,"line");u.setAttribute("x1",String(300)),u.setAttribute("y1",String(270)),u.setAttribute("x2",String(300+Math.cos(l)*200)),u.setAttribute("y2",String(270+Math.sin(l)*200)),u.classList.add("gameover-ray"),s.appendChild(u)}const a=document.createElementNS(m,"text");a.setAttribute("x",String(300)),a.setAttribute("y",String(200)),a.classList.add("gameover-title"),a.textContent="GAME OVER",s.appendChild(a);const o=["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"];for(let h=0;h<e.length;h++){const l=e[h],d=h===e.length-1?"":o[h]??"",p=260+h*42,g=document.createElementNS(m,"text");g.setAttribute("x",String(300)),g.setAttribute("y",String(p)),g.classList.add("gameover-rank"),g.style.fill=l.color,g.style.animationDelay=`${.3+h*.2}s`,g.textContent=`#${h+1}  ${d} ${l.name}`,s.appendChild(g)}this.svg.appendChild(s)}onPieceClick(e){this.onPieceClickCb=e}onPositionClick(e){this.onPositionClickCb=e}onNewPieceClick(e){this.onNewPieceClickCb=e}triggerNewPieceClick(){var e;(e=this.onNewPieceClickCb)==null||e.call(this)}}const R="http://www.w3.org/2000/svg";class ae{constructor(){c(this,"throwArea");c(this,"throwSvg");c(this,"throwResult");this.throwArea=document.getElementById("throw-area"),this.throwSvg=document.getElementById("throw-svg"),this.throwResult=document.getElementById("throw-result")}async animate(e){for(this.throwArea.classList.remove("hidden"),this.throwResult.textContent="";this.throwSvg.firstChild;)this.throwSvg.removeChild(this.throwSvg.firstChild);const t=20,i=70,s=50,n=(300-(4*t+3*s))/2;for(let o=0;o<4;o++){const h=n+o*(t+s),l=25,u=e.sticks[o],d=document.createElementNS(R,"g");d.style.animationDelay=`${o*.1}s`,d.classList.add("stick-tumbling");const p=document.createElementNS(R,"rect");if(p.setAttribute("x",String(h)),p.setAttribute("y",String(l)),p.setAttribute("width",String(t)),p.setAttribute("height",String(i)),p.classList.add("yut-stick"),p.classList.add(u?"flat":"round"),d.appendChild(p),!u){const g=h+t/2,v=4,G=[l+17,l+35,l+53];for(const N of G){const b=document.createElementNS(R,"g");b.classList.add("stick-x-mark");const w=document.createElementNS(R,"line");w.setAttribute("x1",String(g-v)),w.setAttribute("y1",String(N-v)),w.setAttribute("x2",String(g+v)),w.setAttribute("y2",String(N+v));const I=document.createElementNS(R,"line");I.setAttribute("x1",String(g+v)),I.setAttribute("y1",String(N-v)),I.setAttribute("x2",String(g-v)),I.setAttribute("y2",String(N+v)),b.appendChild(w),b.appendChild(I),d.appendChild(b)}}this.throwSvg.appendChild(d)}await new Promise(o=>setTimeout(o,600));const r=D.KOREAN_NAMES[e.name],a=e.value>=4?"#ffeb3b":e.value===-1?"#e74c3c":"#fff";this.throwResult.innerHTML=`<span style="color:${a}">${e.name} ${r} (${e.value>0?"+":""}${e.value})</span>`,await new Promise(o=>setTimeout(o,800))}hide(){this.throwArea.classList.add("hidden")}}class F{constructor(){c(this,"resolveMove",null)}chooseMove(e,t){return new Promise(i=>{this.resolveMove=i})}submitMove(e,t,i){var s;(s=this.resolveMove)==null||s.call(this,{pieceId:e,steps:t,destination:i}),this.resolveMove=null}submitSkip(){var e;(e=this.resolveMove)==null||e.call(this,null),this.resolveMove=null}}class oe{async chooseMove(e,t){const i=t[Math.floor(Math.random()*t.length)];return{pieceId:i.pieceId,steps:i.steps,destination:i.destination}}}const _=class _{constructor(e,t,i=100){c(this,"game");c(this,"playerId");c(this,"numSimulations");this.game=e,this.playerId=t,this.numSimulations=i}async chooseMove(e,t){const i=new Map;for(const a of t){let o;a.pieceId===-1?o=`entry:${a.steps}:${a.destination}`:o=`${this.game.players[this.playerId].getPieceById(a.pieceId).position}:${a.steps}:${a.destination}`,i.has(o)||i.set(o,a)}const s=[...i.values()];if(s.length===1){const a=s[0];return{pieceId:a.pieceId,steps:a.steps,destination:a.destination}}const n=[];for(const a of s){let o=0;for(let h=0;h<this.numSimulations;h++)o+=this.simulate(a.pieceId,a.steps,a.destination);n.push({move:a,winRate:o/this.numSimulations})}n.sort((a,o)=>o.winRate-a.winRate),console.log(`[MC] Evaluating ${n.length} moves (${this.numSimulations} sims each):`);for(const{move:a,winRate:o}of n){const h=a===n[0].move?" <<":"";console.log(`  piece=${a.pieceId} steps=${a.steps} dest=${a.destination}: ${(o*100).toFixed(1)}%${h}`)}const r=n[0].move;return{pieceId:r.pieceId,steps:r.steps,destination:r.destination}}simulate(e,t,i){const s=this.game.clone(),n=this.playerId,r=s.rankings.length,{success:a,captured:o}=s.movePiece(n,e,t,i);if(!a)return 0;if(o&&s.throwPhase(!0),s.checkWinCondition(),s.rankings.length>r||(this.playRemainingMoves(s,n),s.rankings.length>r))return s.rankings[r]===n?1:0;if(s.gameState!=="playing")return 0;s.nextTurn();for(let h=0;h<_.MAX_ROLLOUT_TURNS&&s.gameState==="playing";h++){const l=s.currentPlayerIdx;if(s.throwPhase(),this.playRemainingMoves(s,l),s.rankings.length>r)return s.rankings[r]===n?1:0;s.nextTurn()}return s.rankings.length>r?s.rankings[r]===n?1:0:this.heuristicScore(s)}playRemainingMoves(e,t){for(;e.accumulatedMoves.length>0;){const i=e.getLegalMoves(t);if(i.length===0){e.accumulatedMoves=[];break}const s=i[Math.floor(Math.random()*i.length)],{success:n,captured:r}=e.movePiece(t,s.pieceId,s.steps,s.destination);if(!n){e.accumulatedMoves=[];break}if(r&&e.throwPhase(!0),e.checkWinCondition())break}}heuristicScore(e){const t=e.players[this.playerId].getFinishedPieces().length;let i=t/4,s=0;for(const n of e.players)n.playerId!==this.playerId&&(s=Math.max(s,n.getFinishedPieces().length));return t>s&&(i+=.1),i}};c(_,"MAX_ROLLOUT_TURNS",200);let W=_;class Q{constructor(e,t,i=null,s=null){c(this,"game");c(this,"playerId");c(this,"parent");c(this,"children");c(this,"untriedActions");c(this,"action");c(this,"visits");c(this,"wins");this.game=e,this.playerId=t,this.parent=i,this.children=[],this.action=s,this.visits=0,this.wins=0,this.untriedActions=null}getUntriedActions(){if(this.untriedActions!==null)return this.untriedActions;if(this.game.accumulatedMoves.length===0)return this.untriedActions=[],this.untriedActions;const e=this.game.getLegalMoves(this.playerId);if(e.length===0)return this.untriedActions=[],this.untriedActions;const t=new Map;for(const r of e){let a;r.pieceId===-1?a=`entry:${r.steps}:${r.destination}`:a=`${this.game.players[this.playerId].getPieceById(r.pieceId).position}:${r.steps}:${r.destination}`,t.has(a)||t.set(a,r)}const i=[...t.values()].map(r=>({pieceId:r.pieceId,steps:r.steps,destination:r.destination})),s=new Set(["xx","yy","cc","pp","qq","15","16","17","18","19"]);return this.game.players[this.playerId].getActivePieces().some(r=>s.has(r.position))&&i.push(null),this.untriedActions=i,this.untriedActions}isTerminal(){return this.game.accumulatedMoves.length===0||this.game.gameState!=="playing"||this.game.checkWinCondition()}ucb1(e=1.414){return this.visits===0?1/0:this.wins/this.visits+e*Math.sqrt(Math.log(this.parent.visits)/this.visits)}bestChild(){let e=this.children[0],t=e.ucb1();for(let i=1;i<this.children.length;i++){const s=this.children[i].ucb1();s>t&&(t=s,e=this.children[i])}return e}mostVisitedChild(){let e=this.children[0];for(let t=1;t<this.children.length;t++)this.children[t].visits>e.visits&&(e=this.children[t]);return e}}const q=class q{constructor(e,t,i=1e3){c(this,"game");c(this,"playerId");c(this,"numIterations");c(this,"reuseRoot",null);this.game=e,this.playerId=t,this.numIterations=i}movesMatch(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}async chooseMove(e,t){const i=new Map;for(const l of t){let u;l.pieceId===-1?u=`entry:${l.steps}:${l.destination}`:u=`${this.game.players[this.playerId].getPieceById(l.pieceId).position}:${l.steps}:${l.destination}`,i.has(u)||i.set(u,l)}const s=[...i.values()];if(s.length===1){this.reuseRoot=null;const l=s[0];return{pieceId:l.pieceId,steps:l.steps,destination:l.destination}}let n=null,r=0;this.reuseRoot!==null&&(this.movesMatch(this.reuseRoot.game.accumulatedMoves,this.game.accumulatedMoves)&&(n=this.reuseRoot,r=n.visits,n.parent=null),this.reuseRoot=null),n===null&&(n=new Q(this.game.clone(),this.playerId));for(let l=0;l<this.numIterations;l++){const u=this.select(n),d=this.expand(u),p=this.simulate(d);this.backpropagate(d,p)}if(n.children.length===0){this.reuseRoot=null;const l=s[0];return{pieceId:l.pieceId,steps:l.steps,destination:l.destination}}const a=n.mostVisitedChild();this.reuseRoot=a.action!==null?a:null;const o=r?` (reused ${r} prior visits)`:"",h=[...n.children].sort((l,u)=>u.visits-l.visits);console.log(`[MCTS] ${this.numIterations} iterations${o}, ${n.children.length} root children:`);for(const l of h){const u=l.visits>0?l.wins/l.visits:0,d=l.action===null?"skip":`piece=${l.action.pieceId} steps=${l.action.steps} dest=${l.action.destination}`,p=l===a?" <<":"";console.log(`  ${d}: ${l.visits} visits, ${(u*100).toFixed(1)}% winrate${p}`)}return a.action}select(e){for(;!e.isTerminal();){if(e.getUntriedActions().length>0||e.children.length===0)return e;e=e.bestChild()}return e}expand(e){const t=e.getUntriedActions();if(t.length===0||e.isTerminal())return e;const i=t.pop(),s=e.game.clone();if(i===null)s.accumulatedMoves=[];else{const{success:r,captured:a}=s.movePiece(this.playerId,i.pieceId,i.steps,i.destination);if(!r)return e;a&&s.throwPhase(!0),s.checkWinCondition()}const n=new Q(s,this.playerId,e,i);return e.children.push(n),n}simulate(e){const t=e.game.clone(),i=this.playerId,s=t.rankings.length;if(t.rankings.length>s||(this.playRemainingMoves(t,i),t.rankings.length>s))return t.rankings[s]===i?1:0;if(t.gameState!=="playing")return 0;t.nextTurn();for(let n=0;n<q.MAX_ROLLOUT_TURNS&&t.gameState==="playing";n++){const r=t.currentPlayerIdx;if(t.throwPhase(),this.playRemainingMoves(t,r),t.rankings.length>s)return t.rankings[s]===i?1:0;t.nextTurn()}return t.rankings.length>s?t.rankings[s]===i?1:0:this.heuristicScore(t)}backpropagate(e,t){for(;e!==null;)e.visits+=1,e.wins+=t,e=e.parent}playRemainingMoves(e,t){for(;e.accumulatedMoves.length>0;){const i=e.getLegalMoves(t);if(i.length===0){e.accumulatedMoves=[];break}const s=i[Math.floor(Math.random()*i.length)],{success:n,captured:r}=e.movePiece(t,s.pieceId,s.steps,s.destination);if(!n){e.accumulatedMoves=[];break}if(r&&e.throwPhase(!0),e.checkWinCondition())break}}heuristicScore(e){const t=e.players[this.playerId].getFinishedPieces().length;let i=t/4,s=0;for(const n of e.players)n.playerId!==this.playerId&&(s=Math.max(s,n.getFinishedPieces().length));return t>s&&(i+=.1),i}};c(q,"MAX_ROLLOUT_TURNS",200);let X=q;class ce{constructor(e=!1){c(this,"game");c(this,"renderer");c(this,"throwAnim");c(this,"controllers",[]);c(this,"controllerTypes",[]);c(this,"phase","setup");c(this,"fast");c(this,"selectedPieceId",null);c(this,"currentLegalMoves",[]);c(this,"currentThrows",[]);c(this,"setupOverlay");c(this,"gameContainer");c(this,"helpOverlay");c(this,"playerStatus");c(this,"movesList");c(this,"historyLog");c(this,"actionButtons");c(this,"statusMessage");this.fast=e}init(){this.setupOverlay=document.getElementById("setup-overlay"),this.gameContainer=document.getElementById("game-container"),this.helpOverlay=document.getElementById("help-overlay"),this.playerStatus=document.getElementById("player-status"),this.movesList=document.getElementById("moves-list"),this.historyLog=document.getElementById("history-log"),this.actionButtons=document.getElementById("action-buttons"),this.statusMessage=document.getElementById("status-message"),this.setupPlayerConfigUI(),this.setupEventListeners()}setupPlayerConfigUI(){const e=document.getElementById("player-count"),t=document.getElementById("player-configs"),i=ie,s=()=>{const r=Number(e.value);t.innerHTML="";for(let a=0;a<r;a++){const o=document.createElement("div");o.className="player-config",o.style.borderColor=B[a],o.innerHTML=`
          <input type="text" value="${i[a]}" data-player="${a}" class="player-name-input" placeholder="Player ${a+1}" />
          <select data-player="${a}" class="player-type-select">
            <option value="human"${a===0?" selected":""}>Human</option>
            <option value="random"${a>=1&&a<2?" selected":""}>AI (Easy)</option>
            <option value="mc"${a>=2?" selected":""}>AI (Normal)</option>
            <option value="mcts">AlphaYutNori</option>
          </select>
        `;const h=o.querySelector("select");a===0?h.value="human":h.value="random",t.appendChild(o)}};e.addEventListener("change",s),s();const n=document.getElementById("fast-mode");this.fast&&(n.checked=!0),document.getElementById("start-btn").addEventListener("click",()=>{const r=Number(e.value),a=[];for(let o=0;o<r;o++){const h=t.querySelector(`input[data-player="${o}"]`),l=t.querySelector(`select[data-player="${o}"]`);a.push({name:h.value||`Player ${o}`,type:l.value})}this.fast=n.checked,this.startGame(a)})}setupEventListeners(){document.getElementById("help-btn").addEventListener("click",()=>this.toggleHelp()),document.getElementById("help-close-btn").addEventListener("click",()=>this.toggleHelp()),document.getElementById("settings-btn").addEventListener("click",()=>this.returnToSetup()),document.addEventListener("keydown",e=>this.handleKeydown(e))}handleKeydown(e){if(e.key==="?"){e.preventDefault(),this.toggleHelp();return}if(this.phase==="throwing")(e.key===" "||e.key==="Enter")&&(e.preventDefault(),this.performThrow());else if(this.phase==="selecting_piece"){const i={q:0,w:1,e:2,r:3}[e.key.toLowerCase()];i!==void 0?(e.preventDefault(),this.trySelectPieceById(i)):e.key==="n"||e.key==="N"?(e.preventDefault(),this.tryEnterNewPiece()):e.key==="0"&&(e.preventDefault(),this.skipRemainingMoves())}else if(this.phase==="selecting_move"){e.key==="Escape"&&(e.preventDefault(),this.backToPieceSelection());const i={q:0,w:1,e:2,r:3}[e.key.toLowerCase()];if(i!==void 0){const s=this.actionButtons.querySelectorAll(".btn-move");i<s.length&&(e.preventDefault(),s[i].click())}}}toggleHelp(){this.helpOverlay.classList.toggle("hidden")}returnToSetup(){this.gameContainer.classList.add("hidden"),this.setupOverlay.classList.remove("hidden"),this.phase="setup"}startGame(e){const t=e.map(s=>s.name);this.game=new z(t,e.length),this.controllers=[],this.controllerTypes=[];for(let s=0;s<e.length;s++)switch(this.controllerTypes.push(e[s].type),e[s].type){case"human":this.controllers.push(new F);break;case"random":this.controllers.push(new oe);break;case"mc":this.controllers.push(new W(this.game,s,100));break;case"mcts":this.controllers.push(new X(this.game,s,1e3));break}this.setupOverlay.classList.add("hidden"),this.gameContainer.classList.remove("hidden");const i=document.getElementById("board-svg");i.innerHTML="",this.renderer=new re(i),this.throwAnim=new ae,this.renderer.onPieceClick((s,n)=>{this.phase==="selecting_piece"&&s===this.game.currentPlayerIdx&&this.selectPiece(n)}),this.renderer.onNewPieceClick(()=>{this.phase==="selecting_piece"&&this.tryEnterNewPiece()}),this.renderer.onPositionClick(s=>{if(this.phase==="selecting_move"&&this.selectedPieceId!==null){const n=this.getMovesForPiece(this.selectedPieceId).filter(r=>r.destination===s);n.length>0&&this.executeMove(n[0].pieceId,n[0].steps,n[0].destination)}}),this.updateDisplay(),this.startTurn()}async startTurn(){if(this.game.gameState==="finished"){this.showGameOver();return}const e=this.game.getCurrentPlayer(),t=this.controllerTypes[this.game.currentPlayerIdx]==="human";this.phase="throwing",this.updateDisplay(),t?(this.setStatus(`${e.name}'s turn â€” click Throw or press Space`),this.showThrowButton()):(this.setStatus(`${e.name} (AI) is throwing...`),this.clearActions(),await this.delay(300),this.phase="throwing",await this.performThrow())}showThrowButton(){this.actionButtons.innerHTML="";const e=document.createElement("button");e.className="btn btn-primary",e.textContent="Throw (Space)",e.addEventListener("click",()=>this.performThrow()),this.actionButtons.appendChild(e)}async performThrow(){if(this.phase!=="throwing")return;this.phase="animating",this.clearActions();const e=this.game.throwPhase();if(this.currentThrows=e,!this.fast){for(const t of e)await this.throwAnim.animate(t);this.throwAnim.hide()}this.updateDisplay(),await this.startMovePhase()}async startMovePhase(){for(;this.game.accumulatedMoves.length>0;){const e=this.game.currentPlayerIdx,t=this.game.getLegalMoves(e);if(this.currentLegalMoves=t,t.length===0){this.game.accumulatedMoves=[];break}const i=this.controllerTypes[e]==="human";if(i){this.phase="selecting_piece",this.showPieceSelection(t),this.updateDisplay();const n=await this.controllers[e].chooseMove(this.game.getGameState(),t);if(n===null){this.game.accumulatedMoves=[];break}const{captured:r}=this.game.movePiece(e,n.pieceId,n.steps,n.destination);if(this.renderer.clearHighlights(),this.updateDisplay(),await this.delay(300),r&&(this.addHistory("Capture! Bonus throw!",!0),this.fast||await this.renderer.showCaptureEffect(),this.phase="throwing",this.updateDisplay(),this.setStatus(`${this.game.getCurrentPlayer().name} captured â€” bonus throw!`),i?(this.showThrowButton(),await new Promise(a=>{const o=this.performThrow.bind(this);this.performThrow=async()=>{if(this.performThrow=o,this.phase!=="throwing")return;this.phase="animating",this.clearActions();const h=this.game.throwPhase(!0);if(!this.fast){for(const l of h)await this.throwAnim.animate(l);this.throwAnim.hide()}this.updateDisplay(),a()}})):(this.game.throwPhase(!0),this.updateDisplay())),this.game.checkWinCondition()&&(this.updateDisplay(),this.game.gameState==="finished")){this.showGameOver();return}}else{this.phase="animating",this.setStatus(`${this.game.getCurrentPlayer().name} (AI) is thinking...`),this.clearActions();const n=await this.controllers[e].chooseMove(this.game.getGameState(),t);if(n===null){this.game.accumulatedMoves=[];break}await this.delay(300);const{captured:r}=this.game.movePiece(e,n.pieceId,n.steps,n.destination);if(this.updateDisplay(),await this.delay(400),r){this.addHistory("Capture! Bonus throw!",!0),this.fast||await this.renderer.showCaptureEffect();const a=this.game.throwPhase(!0);if(!this.fast){for(const o of a)await this.throwAnim.animate(o);this.throwAnim.hide()}this.updateDisplay()}if(this.game.checkWinCondition()&&(this.updateDisplay(),this.game.gameState==="finished")){this.showGameOver();return}}}if(this.game.gameState==="finished"){this.showGameOver();return}this.game.nextTurn(),this.updateDisplay(),await this.delay(300),this.startTurn()}showPieceSelection(e){const t=this.game.getCurrentPlayer(),i=new Set(e.map(a=>a.pieceId)),s=i.has(-1),n=new Set([...i].filter(a=>a!==-1));if(this.renderer.highlightPieces(t.playerId,n,s),this.actionButtons.innerHTML="",s){const a=document.createElement("button");a.className="btn",a.textContent="New Piece (N)",a.addEventListener("click",()=>this.tryEnterNewPiece()),this.actionButtons.appendChild(a)}const r=document.createElement("button");r.className="btn",r.textContent="Skip (0)",r.addEventListener("click",()=>this.skipRemainingMoves()),this.actionButtons.appendChild(r),this.setStatus(`${t.name}'s turn â€” select a piece (moves: ${this.game.accumulatedMoves.join(", ")})`)}selectPiece(e){this.selectedPieceId=e,this.phase="selecting_move";const t=this.getMovesForPiece(e);this.showMoveSelection(e,t)}getMovesForPiece(e){return this.currentLegalMoves.filter(t=>t.pieceId===e)}showMoveSelection(e,t){const i=this.game.getCurrentPlayer();e===-1||i.getPieceById(e),this.renderer.clearHighlights(),e!==-1&&this.renderer.selectPiece(i.playerId,e);const s=new Map;for(let a=0;a<t.length;a++){const o=H[a]??"";s.has(t[a].destination)||s.set(t[a].destination,o)}this.renderer.highlightDestinations(s),this.actionButtons.innerHTML="";for(let a=0;a<t.length;a++){const o=t[a];let h;o.destination==="EXIT"?h="EXIT":o.destination==="00"?h="GOAL":(h=o.destination,this.game.board.triggersShortcut(o.destination)&&(h+=" (shortcut)"));const l=H[a]??"",u=document.createElement("button");u.className="btn btn-move",u.textContent=`[${l}] ${o.steps} â†’ ${h}`,u.addEventListener("click",()=>this.executeMove(o.pieceId,o.steps,o.destination)),this.actionButtons.appendChild(u)}const n=document.createElement("button");n.className="btn",n.textContent="Back (Esc)",n.addEventListener("click",()=>this.backToPieceSelection()),this.actionButtons.appendChild(n);const r=e===-1?"new piece":`Piece ${H[e]??e}`;this.setStatus(`${i.name} â€” choose move for ${r}`)}executeMove(e,t,i){if(this.phase!=="selecting_move")return;this.phase="animating",this.renderer.clearHighlights(),this.clearActions();const s=this.controllers[this.game.currentPlayerIdx];s instanceof F&&s.submitMove(e,t,i)}trySelectPieceById(e){this.currentLegalMoves.some(i=>i.pieceId===e)&&this.selectPiece(e)}tryEnterNewPiece(){if(this.phase!=="selecting_piece")return;const e=this.currentLegalMoves.filter(t=>t.pieceId===-1);e.length>0&&(this.selectedPieceId=-1,this.phase="selecting_move",this.showMoveSelection(-1,e))}skipRemainingMoves(){if(this.phase!=="selecting_piece")return;this.phase="animating",this.renderer.clearHighlights(),this.clearActions();const e=this.controllers[this.game.currentPlayerIdx];e instanceof F&&e.submitSkip()}backToPieceSelection(){this.phase==="selecting_move"&&(this.selectedPieceId=null,this.phase="selecting_piece",this.renderer.clearHighlights(),this.showPieceSelection(this.currentLegalMoves),this.updateDisplay())}showGameOver(){this.phase="game_over",this.renderer.clearHighlights();const e=this.game.rankings.map(i=>({name:this.game.players[i].name,color:B[i]}));this.renderer.showGameOverEffect(e),this.actionButtons.innerHTML="";const t=document.createElement("button");t.className="btn btn-primary",t.textContent="New Game",t.addEventListener("click",()=>this.returnToSetup()),this.actionButtons.appendChild(t),this.setStatus("")}updateDisplay(){this.updatePlayerStatus(),this.updateMovesDisplay(),this.updateHistory(),this.renderer.updatePieces(this.game.getAllPieces(),this.game.players,this.game.currentPlayerIdx)}updatePlayerStatus(){const e=["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"],t=this.game.rankings,i=this.game.players.length,s=[...this.game.players].sort((r,a)=>{const o=t.indexOf(r.playerId),h=t.indexOf(a.playerId),l=o!==-1;return l!==(h!==-1)?l?1:-1:l?o-h:r.playerId-a.playerId});let n="<h3>Players</h3>";for(const r of s){const a=r.playerId===this.game.currentPlayerIdx,o=B[r.playerId],h=r.getFinishedPieces().length,l=t.indexOf(r.playerId),u=l!==-1,d=l===i-1,p=u&&!d?e[l]??"":"",g=this.controllerTypes[r.playerId],v=g==="human"?"":g==="random"?" (Easy)":g==="mcts"?" (AlphaYutNori)":" (Normal)";n+=`
        <div class="player-status-item ${a?"current":""}" style="${u?"opacity:0.5":""}">
          <span class="player-dot" style="background:${o}"></span>
          <span class="player-name">${p}${p?" ":""}${r.name}${v}</span>
          <span class="player-score">${h}/4</span>
        </div>
      `}this.playerStatus.innerHTML=n}updateMovesDisplay(){const e=this.game.accumulatedMoves;if(e.length===0){this.movesList.textContent="No moves";return}this.movesList.innerHTML=e.map(t=>`<span class="btn btn-small btn-move">${t>0?"+":""}${t}</span>`).join(" ")}updateHistory(){const e=this.game.moveHistory.slice(-15);this.historyLog.innerHTML=e.map(t=>`<div class="history-entry${t.includes("captured")?" capture":""}">${t}</div>`).join(""),this.historyLog.scrollTop=this.historyLog.scrollHeight}addHistory(e,t=!1){const i=document.createElement("div");i.className=`history-entry${t?" capture":""}`,i.textContent=e,this.historyLog.appendChild(i),this.historyLog.scrollTop=this.historyLog.scrollHeight}setStatus(e){this.statusMessage.textContent=e}clearActions(){this.actionButtons.innerHTML=""}delay(e){return this.fast&&(e=Math.min(e,50)),new Promise(t=>setTimeout(t,e))}}const le=new URLSearchParams(window.location.search).has("fast"),he=new ce(le);he.init();
